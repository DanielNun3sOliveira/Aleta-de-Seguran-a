<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguran√ßa JW - Registro de Alertas</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            --primary: #2e7d32;
            --accent: #ff6600;
            --glow: rgba(46, 125, 50, 0.3);
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: background 0.5s ease;
        }

        .card {
            width: 100%;
            max-width: 700px;
            background: var(--card-bg);
            border-radius: 40px;
            padding: 45px;
            position: relative;
            border: 5px solid var(--primary);
            box-shadow: 0 20px 60px var(--glow);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            animation: pulseGlow 4s infinite;
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 10px 40px var(--glow); }
            50% { box-shadow: 0 20px 70px var(--glow); }
            100% { box-shadow: 0 10px 40px var(--glow); }
        }

        .header { display: flex; align-items: center; margin-bottom: 40px; position: relative; }
        .logo { font-size: 48px; font-weight: 900; color: #000; letter-spacing: -2px; z-index: 5; }
        .logo span { color: var(--accent); }
        .title-box { position: absolute; width: 100%; text-align: center; }
        .main-title {
            background: var(--primary);
            color: white;
            padding: 12px 35px;
            border-radius: 50px;
            font-size: 22px;
            font-weight: 800;
            text-transform: uppercase;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            display: inline-block;
        }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-size: 11px; font-weight: 800; color: #444; margin-bottom: 8px; text-transform: uppercase; }

        input, select, textarea {
            width: 100%; padding: 16px; border: 2px solid rgba(0,0,0,0.1);
            border-radius: 15px; background: rgba(255,255,255,0.7);
            font-size: 14px; transition: 0.3s; outline: none; box-sizing: border-box;
        }

        input:focus, select:focus, textarea:focus { border-color: var(--primary); background: #fff; transform: translateY(-2px); }

        .upload-area { border: 3px dashed var(--primary); background: rgba(255,255,255,0.4); padding: 20px; border-radius: 20px; text-align: center; }

        .btn-submit {
            width: 100%; padding: 22px; background: var(--primary); color: white;
            border: none; border-radius: 20px; font-size: 20px; font-weight: 900;
            text-transform: uppercase; cursor: pointer; transition: 0.4s; margin-top: 15px;
        }

        .btn-submit:disabled { background: #ccc !important; cursor: not-allowed; }

        /* Estados de Cores */
        .card.baixa { --primary: #2e7d32; --glow: rgba(46, 125, 50, 0.4); --card-bg: #f1f8e9; }
        .card.media { --primary: #ffa000; --glow: rgba(255, 160, 0, 0.4); --card-bg: #fff8e1; }
        .card.alta { --primary: #d32f2f; --glow: rgba(211, 47, 47, 0.4); --card-bg: #ffebee; }

        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } .header { flex-direction: column; } .title-box { position: static; margin-top: 15px; } }
    </style>
</head>
<body id="pageBody">

<div class="card" id="formCard">
    <div class="header">
        <div class="logo">N<span>.</span></div>
        <div class="title-box"><div class="main-title">Alerta de Seguran√ßa</div></div>
    </div>

    <form id="safetyForm">
        <div class="grid">
            <div class="input-group">
                <label>üìÖ Data da Ocorr√™ncia *</label>
                <input type="date" id="data" required>
            </div>
            <div class="input-group">
                <label>‚ö†Ô∏è Gravidade / Tipo *</label>
                <select id="gravidade" onchange="updateTheme()" required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="baixa">BAIXA (Quase Acidente / Informativo)</option>
                    <option value="media">M√âDIA (Condi√ß√£o Insegura / Dano Material)</option>
                    <option value="alta">ALTA (Acidente / Perigo Cr√≠tico)</option>
                </select>
            </div>
        </div>

        <div class="grid">
            <div class="input-group">
                <label>üè¢ √Årea *</label>
                <select id="area" required>
                    <option value="" disabled selected>Selecionar √Årea...</option>
                    <option value="Docas">Docas</option>
                    <option value="Picking">Picking</option>
                    <option value="Loja">Loja</option>
                    <option value="Recuada">Recuada</option>
                    <option value="Armazem A04">Armazem A04</option>
                    <option value="Montagem">Montagem</option>
                    <option value="Avaria">Avaria</option>
                    <option value="Sala de Bateria">Sala de Bateria</option>
                    <option value="Escrit√≥rios">Escrit√≥rios</option>
                    <option value="Vesti√°rios">Vesti√°rios</option>
                    <option value="Tr√°fego">Tr√°fego</option>
                    <option value="Portaria">Portaria</option>
                    <option value="PD">PD</option>
                    <option value="P√°tio">P√°tio</option>
                </select>
            </div>
            <div class="input-group">
                <label>üìç Local Espec√≠fico *</label>
                <input type="text" id="local_especifico" placeholder="Ex: Rua 10, Box 05..." required>
            </div>
        </div>

        <div class="input-group">
            <label>üìù Descri√ß√£o da Ocorr√™ncia *</label>
            <textarea id="descricao" rows="3" placeholder="Descreva os detalhes observados..." required></textarea>
        </div>

        <div class="input-group">
            <label>üì∏ Fotos Obrigat√≥rias *</label>
            <div class="upload-area">
                <input type="file" id="fotos" accept="image/*" multiple required>
            </div>
        </div>

        <button type="submit" class="btn-submit" id="btnEnviar">Enviar Registro</button>
    </form>
</div>

<script>
    (function(){ emailjs.init("L4H6eNAhaPOP7m2Ii"); })();

    function updateTheme() {
        const val = document.getElementById('gravidade').value;
        const card = document.getElementById('formCard');
        const body = document.getElementById('pageBody');
        card.classList.remove('baixa', 'media', 'alta');
        if(val === 'baixa') { card.classList.add('baixa'); body.style.background = "#e8f5e9"; }
        else if(val === 'media') { card.classList.add('media'); body.style.background = "#fff3e0"; }
        else if(val === 'alta') { card.classList.add('alta'); body.style.background = "#ffebee"; }
    }

    document.getElementById('safetyForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnEnviar');
        const gravidadeSelect = document.getElementById('gravidade');
        btn.disabled = true;
        btn.innerText = "‚è≥ PROCESSANDO REGISTRO...";

        const files = document.getElementById('fotos').files;
        let linksHtml = "";

        // Upload das fotos para o Cloudinary
        for (let f of files) {
            const fd = new FormData();
            fd.append("file", f);
            fd.append("upload_preset", "Falta de Pe√ßa - Registro de Ocorr√™ncias");
            
            try {
                const res = await fetch("https://api.cloudinary.com/v1_1/DHPVTXJJW/image/upload", { method: "POST", body: fd });
                const d = await res.json();
                if(d.secure_url) {
                    linksHtml += `<div style="margin-bottom:10px;"><a href="${d.secure_url}" style="background:#2e7d32; color:white; padding:8px 15px; text-decoration:none; border-radius:5px; font-weight:bold;">Clique para abrir a foto</a></div>`;
                }
            } catch (err) { console.error("Erro foto:", err); }
        }

        const templateParams = {
            data: document.getElementById('data').value.split('-').reverse().join('/'),
            gravidade: gravidadeSelect.options[gravidadeSelect.selectedIndex].text,
            area: document.getElementById('area').value,
            local_especifico: document.getElementById('local_especifico').value,
            descricao: document.getElementById('descricao').value,
            links_fotos: linksHtml
        };

        emailjs.send('service_f8m5n8r', 'template_qmo3tb8', templateParams)
            .then(() => {
                alert("‚úÖ Sucesso! O registro foi enviado.");
                location.reload();
            }, (err) => {
                alert("‚ùå Erro ao enviar. Tente novamente.");
                btn.disabled = false;
                btn.innerText = "Enviar Registro";
            });
    });
</script>
</body>
</html>