<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguran√ßa JW - Registro Din√¢mico</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            --primary: #2e7d32;
            --accent: #ff6600;
            --glow: rgba(46, 125, 50, 0.3);
            --bg-soft: #f0f2f5;
            --card-inner: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-soft);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: all 0.5s ease;
        }

        .card {
            width: 100%;
            max-width: 750px;
            background: var(--card-inner);
            border-radius: 40px;
            padding: 45px;
            border: 6px solid var(--primary);
            box-shadow: 0 25px 50px var(--glow);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header { display: flex; align-items: center; margin-bottom: 40px; gap: 20px; }
        .logo { font-size: 52px; font-weight: 900; color: #000; letter-spacing: -3px; }
        .logo span { color: var(--accent); }
        .main-title {
            background: var(--primary);
            color: white;
            padding: 12px 35px;
            border-radius: 50px;
            font-size: 22px;
            font-weight: 800;
            text-transform: uppercase;
            flex-grow: 1;
            text-align: center;
            transition: 0.5s;
        }

        .alerta-item { 
            border-bottom: 2px dashed var(--primary); 
            margin-bottom: 30px; 
            padding-bottom: 20px;
        }
        .alerta-item:last-of-type { border-bottom: none; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .input-group { margin-bottom: 22px; }
        label { display: block; font-size: 11px; font-weight: 800; color: #333; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }

        input, select, textarea {
            width: 100%; padding: 16px; border: 2px solid rgba(0,0,0,0.1);
            border-radius: 15px; background: rgba(255,255,255,0.5);
            font-size: 15px; transition: 0.3s; outline: none; box-sizing: border-box;
        }

        input:focus, select:focus, textarea:focus { 
            border-color: var(--primary); 
            background: #fff;
            box-shadow: 0 0 10px var(--glow);
        }

        .btn-add {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 10px 20px;
            border-radius: 15px;
            font-weight: 800;
            cursor: pointer;
            margin-bottom: 25px;
            transition: 0.3s;
            width: 100%;
        }
        .btn-add:hover { background: var(--primary); color: white; }

        .btn-submit {
            width: 100%; padding: 22px; background: var(--primary); color: white;
            border: none; border-radius: 18px; font-size: 20px; font-weight: 900;
            text-transform: uppercase; cursor: pointer; transition: 0.4s;
            box-shadow: 0 10px 20px var(--glow);
        }

        .card.baixa { --primary: #2e7d32; --glow: rgba(46, 125, 50, 0.3); --bg-soft: #e8f5e9; --card-inner: #f1f8e9; }
        .card.media { --primary: #ffa000; --glow: rgba(255, 160, 0, 0.3); --bg-soft: #fff3e0; --card-inner: #fffde7; }
        .card.alta { --primary: #d32f2f; --glow: rgba(211, 47, 47, 0.3); --bg-soft: #ffebee; --card-inner: #fff5f5; }

        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } .header { flex-direction: column; text-align: center; } }
    </style>
</head>
<body id="pageBody">

<div class="card" id="formCard">
    <div class="header">
        <div class="logo">N<span>.</span></div>
        <div class="main-title">Alerta de Seguran√ßa</div>
    </div>

    <form id="safetyForm">
        <div id="alertasContainer">
            <div class="alerta-item">
                <div class="grid">
                    <div class="input-group">
                        <label>üìÖ Data da Ocorr√™ncia *</label>
                        <input type="date" class="data" required>
                    </div>
                    <div class="input-group">
                        <label>‚ö†Ô∏è Gravidade / Tipo *</label>
                        <select class="gravidade" onchange="updateTheme()" required>
                            <option value="" disabled selected>Selecione a Gravidade...</option>
                            <option value="baixa">BAIXA (Informativo / Quase Acidente)</option>
                            <option value="media">M√âDIA (Condi√ß√£o Insegura / Dano Material)</option>
                            <option value="alta">ALTA (Acidente / Perigo Cr√≠tico)</option>
                        </select>
                    </div>
                </div>

                <div class="grid">
                    <div class="input-group">
                        <label>üè¢ √Årea (Localiza√ß√£o) *</label>
                        <select class="area" required>
                            <option value="" disabled selected>Escolha o local...</option>
                            <option value="Docas">Docas</option>
                            <option value="Picking">Picking</option>
                            <option value="Loja">Loja</option>
                            <option value="Recuada">Recuada</option>
                            <option value="Armazem A04">Armazem A04</option>
                            <option value="Montagem">Montagem</option>
                            <option value="Avaria">Avaria</option>
                            <option value="Sala de Bateria">Sala de Bateria</option>
                            <option value="Escrit√≥rio 1">Escrit√≥rio 1</option>
                            <option value="Escrit√≥rio 2 (operacional)">Escrit√≥rio 2 (operacional)</option>
                            <option value="Vesti√°rio Masculino">Vesti√°rio Masculino</option>
                            <option value="Vestiario Feminino">Vestiario Feminino</option>
                            <option value="Vesti√°rio JW">Vesti√°rio JW</option>
                            <option value="Tr√°fego">Tr√°fego</option>
                            <option value="Portaria 2">Portaria 2</option>
                            <option value="PD">PD</option>
                            <option value="P√°tio">P√°tio</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üìç Detalhe do Local *</label>
                        <input type="text" class="local_especifico" placeholder="Ex: Rua 10, Box 05..." required>
                    </div>
                </div>

                <div class="input-group">
                    <label>üìù Descri√ß√£o da Ocorr√™ncia *</label>
                    <textarea class="descricao" rows="4" placeholder="Descreva detalhadamente..." required></textarea>
                </div>

                <div class="input-group">
                    <label>üì∏ Fotos Evid√™ncias *</label>
                    <div style="border: 3px dashed var(--primary); padding: 15px; border-radius: 15px; background: rgba(255,255,255,0.3);">
                        <input type="file" class="fotos" accept="image/*" multiple required>
                    </div>
                </div>
            </div>
        </div>

        <button type="button" class="btn-add" onclick="addNovoAlerta()">‚ûï Adicionar Outro Alerta no mesmo Envio</button>
        <button type="submit" class="btn-submit" id="btnEnviar">Enviar Alerta de Seguran√ßa</button>
    </form>
</div>

<script>
    (function(){ emailjs.init("L4H6eNAhaPOP7m2Ii"); })();
    
    let currentThemeColor = "#2e7d32";
    let currentInnerColor = "#f1f8e9";

    function updateTheme() {
        const gravidades = document.querySelectorAll('.gravidade');
        // Pega a gravidade do √∫ltimo alerta adicionado para definir a cor do card
        const val = gravidades[gravidades.length - 1].value;
        const card = document.getElementById('formCard');
        card.classList.remove('baixa', 'media', 'alta');
        
        if(val === 'baixa') { 
            card.classList.add('baixa'); currentThemeColor = "#2e7d32"; currentInnerColor = "#f1f8e9";
        } else if(val === 'media') { 
            card.classList.add('media'); currentThemeColor = "#ffa000"; currentInnerColor = "#fffde7";
        } else if(val === 'alta') { 
            card.classList.add('alta'); currentThemeColor = "#d32f2f"; currentInnerColor = "#fff5f5";
        }
    }

    function addNovoAlerta() {
        const container = document.getElementById('alertasContainer');
        const novoItem = container.firstElementChild.cloneNode(true);
        
        // Limpa os campos do novo formul√°rio
        novoItem.querySelectorAll('input, select, textarea').forEach(field => {
            field.value = "";
        });
        
        container.appendChild(novoItem);
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    document.getElementById('safetyForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnEnviar');
        btn.disabled = true;
        btn.innerText = "üöÄ ENVIANDO...";

        const alertaItens = document.querySelectorAll('.alerta-item');
        let resumoAlertasHtml = "";

        for (let i = 0; i < alertaItens.length; i++) {
            const item = alertaItens[i];
            const files = item.querySelector('.fotos').files;
            let linksHtml = "";

            // Upload das fotos desse item espec√≠fico
            for (let f of files) {
                const fd = new FormData();
                fd.append("file", f);
                fd.append("upload_preset", "ml_default"); 
                try {
                    const res = await fetch("https://api.cloudinary.com/v1_1/dhpvtxjjw/image/upload", { method: "POST", body: fd });
                    const d = await res.json();
                    if(d.secure_url) {
                        linksHtml += `<div style="margin-bottom:10px;"><a href="${d.secure_url}" target="_blank" style="display:inline-block; padding:12px 20px; background-color: ${currentThemeColor}; color: #ffffff; text-decoration: none; border-radius: 10px; font-weight: bold;">üìÇ VER FOTO</a></div>`;
                    }
                } catch (err) { console.error(err); }
            }

            // Monta o resumo individual no corpo do e-mail
            resumoAlertasHtml += `
                <div style="border: 2px solid ${currentThemeColor}; padding: 15px; margin-bottom: 20px; border-radius: 20px;">
                    <h3>Alerta #${i+1}</h3>
                    <p><b>Data:</b> ${item.querySelector('.data').value.split('-').reverse().join('/')}</p>
                    <p><b>Gravidade:</b> ${item.querySelector('.gravidade').options[item.querySelector('.gravidade').selectedIndex].text}</p>
                    <p><b>√Årea:</b> ${item.querySelector('.area').value}</p>
                    <p><b>Local:</b> ${item.querySelector('.local_especifico').value}</p>
                    <p><b>Descri√ß√£o:</b> ${item.querySelector('.descricao').value}</p>
                    ${linksHtml}
                </div>
                <hr>`;
        }

        const templateParams = {
            // Unificamos as informa√ß√µes para o e-mail
            descricao: "M√∫ltiplos alertas registrados em um √∫nico formul√°rio.",
            links_fotos: resumoAlertasHtml,
            cor_tema: currentThemeColor,
            cor_fundo_email: currentInnerColor
        };

        emailjs.send('service_0lls186', 'template_qmo3tb8', templateParams)
            .then(() => { alert("‚úÖ Sucesso! " + alertaItens.length + " alerta(s) enviado(s)."); location.reload(); })
            .catch(() => { alert("‚ùå Erro."); btn.disabled = false; btn.innerText = "Enviar Alerta de Seguran√ßa"; });
    });
</script>
</body>
</html>