<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguran√ßa JW - Registro Din√¢mico</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            --primary: #2e7d32;
            --accent: #ff6600;
            --glow: rgba(46, 125, 50, 0.3);
            --bg-soft: #f0f2f5;
            --card-inner: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-soft);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: all 0.5s ease;
        }

        .card {
            width: 100%;
            max-width: 750px;
            background: var(--card-inner);
            border-radius: 40px;
            padding: 45px;
            border: 6px solid var(--primary);
            box-shadow: 0 25px 50px var(--glow);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header { display: flex; align-items: center; margin-bottom: 40px; gap: 20px; }
        .logo { font-size: 52px; font-weight: 900; color: #000; letter-spacing: -3px; }
        .logo span { color: var(--accent); }
        .main-title {
            background: var(--primary);
            color: white;
            padding: 12px 35px;
            border-radius: 50px;
            font-size: 22px;
            font-weight: 800;
            text-transform: uppercase;
            flex-grow: 1;
            text-align: center;
            transition: 0.5s;
        }

        .alerta-item { 
            border: 2px solid #ddd;
            border-radius: 25px;
            margin-bottom: 30px; 
            padding: 20px;
            background: rgba(255,255,255,0.5);
        }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .input-group { margin-bottom: 22px; }
        label { display: block; font-size: 11px; font-weight: 800; color: #333; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }

        input, select, textarea {
            width: 100%; padding: 16px; border: 2px solid rgba(0,0,0,0.1);
            border-radius: 15px; background: #fff;
            font-size: 15px; transition: 0.3s; outline: none; box-sizing: border-box;
        }

        .btn-add {
            background: #f0f0f0;
            color: #333;
            border: 2px dashed #ccc;
            padding: 15px;
            border-radius: 15px;
            font-weight: 800;
            cursor: pointer;
            margin-bottom: 25px;
            transition: 0.3s;
            width: 100%;
        }
        .btn-add:hover { background: #e0e0e0; border-color: #999; }

        .btn-submit {
            width: 100%; padding: 22px; background: var(--primary); color: white;
            border: none; border-radius: 18px; font-size: 20px; font-weight: 900;
            text-transform: uppercase; cursor: pointer; transition: 0.4s;
            box-shadow: 0 10px 20px var(--glow);
        }

        .card.baixa { --primary: #2e7d32; --glow: rgba(46, 125, 50, 0.3); --bg-soft: #e8f5e9; }
        .card.media { --primary: #ffa000; --glow: rgba(255, 160, 0, 0.3); --bg-soft: #fff3e0; }
        .card.alta { --primary: #d32f2f; --glow: rgba(211, 47, 47, 0.3); --bg-soft: #ffebee; }

        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } .header { flex-direction: column; text-align: center; } }
    </style>
</head>
<body id="pageBody">

<div class="card" id="formCard">
    <div class="header">
        <div class="logo">N<span>.</span></div>
        <div class="main-title">Alerta de Seguran√ßa</div>
    </div>

    <form id="safetyForm">
        <div id="alertasContainer">
            <div class="alerta-item">
                <div class="grid">
                    <div class="input-group">
                        <label>üìÖ Data da Ocorr√™ncia *</label>
                        <input type="date" class="data" required>
                    </div>
                    <div class="input-group">
                        <label>‚ö†Ô∏è Gravidade / Tipo *</label>
                        <select class="gravidade" onchange="updateTheme()" required>
                            <option value="" disabled selected>Selecione...</option>
                            <option value="baixa">BAIXA (Informativo / Quase Acidente)</option>
                            <option value="media">M√âDIA (Condi√ß√£o Insegura / Dano Material)</option>
                            <option value="alta">ALTA (Acidente / Perigo Cr√≠tico)</option>
                        </select>
                    </div>
                </div>

                <div class="grid">
                    <div class="input-group">
                        <label>üè¢ √Årea (Localiza√ß√£o) *</label>
                        <select class="area" required>
                            <option value="" disabled selected>Escolha o local...</option>
                            <option value="Docas">Docas</option>
                            <option value="Picking">Picking</option>
                            <option value="Loja">Loja</option>
                            <option value="Recuada">Recuada</option>
                            <option value="Armazem A04">Armazem A04</option>
                            <option value="Montagem">Montagem</option>
                            <option value="Avaria">Avaria</option>
                            <option value="Sala de Bateria">Sala de Bateria</option>
                            <option value="Escrit√≥rio 1">Escrit√≥rio 1</option>
                            <option value="Escrit√≥rio 2 (operacional)">Escrit√≥rio 2 (operacional)</option>
                            <option value="Vesti√°rio Masculino">Vesti√°rio Masculino</option>
                            <option value="Vestiario Feminino">Vestiario Feminino</option>
                            <option value="Vesti√°rio JW">Vesti√°rio JW</option>
                            <option value="Tr√°fego">Tr√°fego</option>
                            <option value="Portaria 2">Portaria 2</option>
                            <option value="PD">PD</option>
                            <option value="P√°tio">P√°tio</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üìç Detalhe do Local *</label>
                        <input type="text" class="local_especifico" placeholder="Ex: Rua 10, Box 05..." required>
                    </div>
                </div>

                <div class="input-group">
                    <label>üìù Descri√ß√£o da Ocorr√™ncia *</label>
                    <textarea class="descricao" rows="3" placeholder="Descreva detalhadamente..." required></textarea>
                </div>

                <div class="input-group">
                    <label>üì∏ Fotos Evid√™ncias *</label>
                    <input type="file" class="fotos" accept="image/*" multiple required>
                </div>
            </div>
        </div>

        <button type="button" class="btn-add" onclick="addNovoAlerta()">+ ADICIONAR OUTRO ALERTA</button>
        <button type="submit" class="btn-submit" id="btnEnviar">ENVIAR TODOS OS ALERTAS</button>
    </form>
</div>

<script>
    (function(){ emailjs.init("L4H6eNAhaPOP7m2Ii"); })();
    
    function updateTheme() {
        const selects = document.querySelectorAll('.gravidade');
        const lastVal = selects[selects.length - 1].value;
        const card = document.getElementById('formCard');
        card.classList.remove('baixa', 'media', 'alta');
        if(lastVal) card.classList.add(lastVal);
    }

    function addNovoAlerta() {
        const container = document.getElementById('alertasContainer');
        const clone = container.firstElementChild.cloneNode(true);
        clone.querySelectorAll('input, select, textarea').forEach(f => f.value = "");
        container.appendChild(clone);
    }

    document.getElementById('safetyForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnEnviar');
        btn.disabled = true;
        btn.innerText = "üöÄ ENVIANDO...";

        const alertaItens = document.querySelectorAll('.alerta-item');
        
        // Loop para enviar cada alerta como um e-mail separado
        for (let item of alertaItens) {
            const gravidadeVal = item.querySelector('.gravidade').value;
            
            // Define as cores espec√≠ficas para este alerta individual
            let corTema = "#2e7d32"; 
            let corFundo = "#f1f8e9";
            if(gravidadeVal === 'media') { corTema = "#ffa000"; corFundo = "#fffde7"; }
            if(gravidadeVal === 'alta') { corTema = "#d32f2f"; corFundo = "#fff5f5"; }

            const files = item.querySelector('.fotos').files;
            let linksHtml = "";

            for (let f of files) {
                const fd = new FormData();
                fd.append("file", f);
                fd.append("upload_preset", "ml_default"); 
                try {
                    const res = await fetch("https://api.cloudinary.com/v1_1/dhpvtxjjw/image/upload", { method: "POST", body: fd });
                    const d = await res.json();
                    if(d.secure_url) {
                        linksHtml += `<div style="margin-bottom:10px;"><a href="${d.secure_url}" target="_blank" style="display:inline-block; padding:12px 20px; background-color: ${corTema}; color: #ffffff; text-decoration: none; border-radius: 10px; font-weight: bold;">üìÇ VER FOTO</a></div>`;
                    }
                } catch (err) { console.error(err); }
            }

            const params = {
                data: item.querySelector('.data').value.split('-').reverse().join('/'),
                gravidade: item.querySelector('.gravidade').options[item.querySelector('.gravidade').selectedIndex].text,
                area: item.querySelector('.area').value,
                local_especifico: item.querySelector('.local_especifico').value,
                descricao: item.querySelector('.descricao').value,
                links_fotos: linksHtml,
                cor_tema: corTema,
                cor_fundo_email: corFundo
            };

            await emailjs.send('service_0lls186', 'template_qmo3tb8', params);
        }

        alert("‚úÖ Todos os alertas foram enviados individualmente!");
        location.reload();
    });
</script>
</body>
</html>